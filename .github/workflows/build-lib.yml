name: Building lib*dlog.so files

on:
  push:
    branches: 
      - "pollard-rho"
      - "pollard-rho-Fp"
      - "baby"
      - "baby-Fp"
      - "pohlig-hellman"

env:
  MAIN_BRANCHES: "pollard-rho","pollard-rho-Fp","baby","baby-Fp"

permissions:
  contents: write

jobs:
  libbuild:
    name: Building .so files
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          ref: pollard-rho
          path: pollard-rho

      - uses: actions/checkout@v4
        with:
          ref: pollard-rho-Fp
          path: pollard-rho-Fp

      - run: echo "my main branches ${MAIN_BRANCHES[0]}"
      - run: echo ${{ fromJSON(MAIN_BRANCHES) }}

      - name: Install libgmp && libxxhash
        run: sudo apt-get install libgmp-dev libxxhash-dev

      - name: Building libdlog for E(Fp)
        run: make libdlogefp

      - name: Pusing libdlog for E(Fp) to this branch
        run: |
          cp so/libdlogefp.so libdlogefp.so
          git config --global user.email "hi_im_mistsu_hehe@gmail.com"
          git config --global user.name "Misuru"
          git add libdlogefp.so
          git commit -m "Automatically compile libdlogefp.so"
          git push